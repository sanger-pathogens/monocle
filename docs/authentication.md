# Authentication

Below is a brief overview of Monocle's JWT-based authentication.

## State
The authentication methods of the GraphQL API set tokens as `HttpOnly` cookies on the client, meaning that they cannot be read by the application's JavaScript. There are two types of cookie:
* a short-lived `authToken`, needed for private API requests
* a long-lived `refreshToken`, needed to refresh the `authToken` without resubmitting login credentials

The various cookie states that the client can be in are outlined in the following diagram. They have colour codes to clarify their meaning.
[![](https://mermaid.ink/img/eyJjb2RlIjoic3RhdGVEaWFncmFtXG4gICAgc3RhdGUgXCJSZWQgKG5vIGFjY2VzcylcIiBhcyByZWQ6YXV0aFRva2VuPWZhbHNlLHJlZnJlc2hUb2tlbj1mYWxzZVxuICAgIHN0YXRlIFwiR3JlZW4gKGZ1bGwgYWNjZXNzKVwiIGFzIGdyZWVuOmF1dGhUb2tlbj10cnVlLHJlZnJlc2hUb2tlbj10cnVlXG4gICAgc3RhdGUgXCJBbWJlciAoYWNjZXNzIHRvIEFQSSdzIHJlZnJlc2ggbWV0aG9kKVwiIGFzIGFtYmVyOmF1dGhUb2tlbj1mYWxzZSxyZWZyZXNoVG9rZW49dHJ1ZVxuICAgIFxuXHRbKl0gLS0-IHJlZFxuICAgIHJlZCAtLT4gZ3JlZW46IGxvZ2luXG4gICAgZ3JlZW4gLS0-IHJlZDogbG9nb3V0XG4gICAgZ3JlZW4gLS0-IGFtYmVyOiBhY2Nlc3MgdG9rZW4gZXhwaXJ5XG4gICAgYW1iZXIgLS0-IGdyZWVuOiByZWZyZXNoKClcbiAgICBhbWJlciAtLT4gcmVkOiByZWZyZXNoIHRva2VuIGV4cGlyeVxuIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtXG4gICAgc3RhdGUgXCJSZWQgKG5vIGFjY2VzcylcIiBhcyByZWQ6YXV0aFRva2VuPWZhbHNlLHJlZnJlc2hUb2tlbj1mYWxzZVxuICAgIHN0YXRlIFwiR3JlZW4gKGZ1bGwgYWNjZXNzKVwiIGFzIGdyZWVuOmF1dGhUb2tlbj10cnVlLHJlZnJlc2hUb2tlbj10cnVlXG4gICAgc3RhdGUgXCJBbWJlciAoYWNjZXNzIHRvIEFQSSdzIHJlZnJlc2ggbWV0aG9kKVwiIGFzIGFtYmVyOmF1dGhUb2tlbj1mYWxzZSxyZWZyZXNoVG9rZW49dHJ1ZVxuICAgIFxuXHRbKl0gLS0-IHJlZFxuICAgIHJlZCAtLT4gZ3JlZW46IGxvZ2luXG4gICAgZ3JlZW4gLS0-IHJlZDogbG9nb3V0XG4gICAgZ3JlZW4gLS0-IGFtYmVyOiBhY2Nlc3MgdG9rZW4gZXhwaXJ5XG4gICAgYW1iZXIgLS0-IGdyZWVuOiByZWZyZXNoKClcbiAgICBhbWJlciAtLT4gcmVkOiByZWZyZXNoIHRva2VuIGV4cGlyeVxuIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)

## Authentication requests

### Login
TODO

### Logout
TODO

## General private requests
The following sequence diagrams outline what happens when a private request is attempted, depending on the colour coded state described above.

### Green
[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAoZ3JlZW4pOiBKUyBzdGF0ZToge2lzTG9nZ2VkSW46IHRydWV9XG4gICAgTm90ZSBvdmVyIGNsaWVudCAoZ3JlZW4pOiBjb29raWUgc3RhdGU6IHthdXRoVG9rZW46IHRydWUsIHJlZnJlc2hUb2tlbjogdHJ1ZX1cblxuICAgIHBhciBwcml2YXRlIHJlcXVlc3RcbiAgICAgICAgY2xpZW50IChncmVlbikgLT4-IHNlcnZlcjogZ2V0U29tZXRoaW5nUHJpdmF0ZShhdXRoVG9rZW5IZWFkZXIsIC4uLmFyZ3MpXG4gICAgICAgIE5vdGUgb3ZlciBzZXJ2ZXI6IHZhbGlkYXRlQXV0aFRva2VuKClcbiAgICAgICAgc2VydmVyIC0-PiBjbGllbnQgKGdyZWVuKTogc29tZXRoaW5nUHJpdmF0ZVxuICAgIGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAoZ3JlZW4pOiBKUyBzdGF0ZToge2lzTG9nZ2VkSW46IHRydWV9XG4gICAgTm90ZSBvdmVyIGNsaWVudCAoZ3JlZW4pOiBjb29raWUgc3RhdGU6IHthdXRoVG9rZW46IHRydWUsIHJlZnJlc2hUb2tlbjogdHJ1ZX1cblxuICAgIHBhciBwcml2YXRlIHJlcXVlc3RcbiAgICAgICAgY2xpZW50IChncmVlbikgLT4-IHNlcnZlcjogZ2V0U29tZXRoaW5nUHJpdmF0ZShhdXRoVG9rZW5IZWFkZXIsIC4uLmFyZ3MpXG4gICAgICAgIE5vdGUgb3ZlciBzZXJ2ZXI6IHZhbGlkYXRlQXV0aFRva2VuKClcbiAgICAgICAgc2VydmVyIC0-PiBjbGllbnQgKGdyZWVuKTogc29tZXRoaW5nUHJpdmF0ZVxuICAgIGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)

### Amber
[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAoYW1iZXIpOiBKUyBzdGF0ZToge2lzTG9nZ2VkSW46IHRydWV9XG4gICAgTm90ZSBvdmVyIGNsaWVudCAoYW1iZXIpOiBjb29raWUgc3RhdGU6IHthdXRoVG9rZW46IGZhbHNlLCByZWZyZXNoVG9rZW46IHRydWV9XG5cbiAgICBwYXIgcHJpdmF0ZSByZXF1ZXN0XG4gICAgICAgIGNsaWVudCAoYW1iZXIpIC0-PiBzZXJ2ZXI6IGdldFNvbWV0aGluZ1ByaXZhdGUobm8gYXV0aFRva2VuSGVhZGVyLCAuLi5hcmdzKVxuICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZUF1dGhUb2tlbigpXG4gICAgICAgIHNlcnZlciAtPj4gY2xpZW50IChhbWJlcik6IGV4cGlyZWRBdXRoVG9rZW5FcnJvclxuICAgIGVuZFxuICAgIFxuICAgIHBhciByZWZyZXNoIGFuZCByZXRyeVxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChhbWJlcik6IGNhdWdodCBieSBnbG9iYWwgaGFuZGxlclxuICAgICAgICBwYXIgdG9rZW4gcmVmcmVzaCByZXF1ZXN0XG4gICAgICAgICAgICBjbGllbnQgKGFtYmVyKSAtPj4gc2VydmVyOiByZWZyZXNoKHJlZnJlc2hUb2tlbkhlYWRlcilcbiAgICAgICAgICAgIE5vdGUgb3ZlciBzZXJ2ZXI6IHZhbGlkYXRlUmVmcmVzaFRva2VuKClcbiAgICAgICAgICAgIHNlcnZlciAtPj4gY2xpZW50IChhbWJlcik6IHNldEF1dGhUb2tlbkNvb2tpZSgpXG4gICAgICAgIGVuZFxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChhbWJlcik6IGNvb2tpZSBzdGF0ZToge2F1dGhUb2tlbjogdHJ1ZSwgcmVmcmVzaFRva2VuOiB0cnVlfVxuICAgICAgICBcbiAgICAgICAgcGFyIHByaXZhdGUgcmVxdWVzdFxuICAgICAgICAgICAgY2xpZW50IChhbWJlcikgLT4-IHNlcnZlcjogZ2V0U29tZXRoaW5nUHJpdmF0ZShhdXRoVG9rZW5IZWFkZXIsIC4uLmFyZ3MpXG4gICAgICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZUF1dGhUb2tlbigpXG4gICAgICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAoYW1iZXIpOiBzb21ldGhpbmdQcml2YXRlXG4gICAgICAgIGVuZFxuICAgIGVuZFxuIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAoYW1iZXIpOiBKUyBzdGF0ZToge2lzTG9nZ2VkSW46IHRydWV9XG4gICAgTm90ZSBvdmVyIGNsaWVudCAoYW1iZXIpOiBjb29raWUgc3RhdGU6IHthdXRoVG9rZW46IGZhbHNlLCByZWZyZXNoVG9rZW46IHRydWV9XG5cbiAgICBwYXIgcHJpdmF0ZSByZXF1ZXN0XG4gICAgICAgIGNsaWVudCAoYW1iZXIpIC0-PiBzZXJ2ZXI6IGdldFNvbWV0aGluZ1ByaXZhdGUobm8gYXV0aFRva2VuSGVhZGVyLCAuLi5hcmdzKVxuICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZUF1dGhUb2tlbigpXG4gICAgICAgIHNlcnZlciAtPj4gY2xpZW50IChhbWJlcik6IGV4cGlyZWRBdXRoVG9rZW5FcnJvclxuICAgIGVuZFxuICAgIFxuICAgIHBhciByZWZyZXNoIGFuZCByZXRyeVxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChhbWJlcik6IGNhdWdodCBieSBnbG9iYWwgaGFuZGxlclxuICAgICAgICBwYXIgdG9rZW4gcmVmcmVzaCByZXF1ZXN0XG4gICAgICAgICAgICBjbGllbnQgKGFtYmVyKSAtPj4gc2VydmVyOiByZWZyZXNoKHJlZnJlc2hUb2tlbkhlYWRlcilcbiAgICAgICAgICAgIE5vdGUgb3ZlciBzZXJ2ZXI6IHZhbGlkYXRlUmVmcmVzaFRva2VuKClcbiAgICAgICAgICAgIHNlcnZlciAtPj4gY2xpZW50IChhbWJlcik6IHNldEF1dGhUb2tlbkNvb2tpZSgpXG4gICAgICAgIGVuZFxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChhbWJlcik6IGNvb2tpZSBzdGF0ZToge2F1dGhUb2tlbjogdHJ1ZSwgcmVmcmVzaFRva2VuOiB0cnVlfVxuICAgICAgICBcbiAgICAgICAgcGFyIHByaXZhdGUgcmVxdWVzdFxuICAgICAgICAgICAgY2xpZW50IChhbWJlcikgLT4-IHNlcnZlcjogZ2V0U29tZXRoaW5nUHJpdmF0ZShhdXRoVG9rZW5IZWFkZXIsIC4uLmFyZ3MpXG4gICAgICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZUF1dGhUb2tlbigpXG4gICAgICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAoYW1iZXIpOiBzb21ldGhpbmdQcml2YXRlXG4gICAgICAgIGVuZFxuICAgIGVuZFxuIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)

### Red
[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAocmVkKTogSlMgc3RhdGU6IHtpc0xvZ2dlZEluOiB0cnVlfVxuICAgIE5vdGUgb3ZlciBjbGllbnQgKHJlZCk6IGNvb2tpZSBzdGF0ZToge2F1dGhUb2tlbjogZmFsc2UsIHJlZnJlc2hUb2tlbjogZmFsc2V9XG5cbiAgICBwYXIgcHJpdmF0ZSByZXF1ZXN0XG4gICAgICAgIGNsaWVudCAocmVkKSAtPj4gc2VydmVyOiBnZXRTb21ldGhpbmdQcml2YXRlKG5vIGF1dGhUb2tlbkhlYWRlciwgLi4uYXJncylcbiAgICAgICAgTm90ZSBvdmVyIHNlcnZlcjogdmFsaWRhdGVBdXRoVG9rZW4oKVxuICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAocmVkKTogZXhwaXJlZEF1dGhUb2tlbkVycm9yXG4gICAgZW5kXG4gICAgXG4gICAgcGFyIHRyeSByZWZyZXNoXG4gICAgICAgIE5vdGUgb3ZlciBjbGllbnQgKHJlZCk6IGNhdWdodCBieSBnbG9iYWwgaGFuZGxlclxuICAgICAgICBwYXIgdG9rZW4gcmVmcmVzaCByZXF1ZXN0XG4gICAgICAgICAgICBjbGllbnQgKHJlZCkgLT4-IHNlcnZlcjogcmVmcmVzaChubyByZWZyZXNoVG9rZW5IZWFkZXIpXG4gICAgICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZVJlZnJlc2hUb2tlbigpXG4gICAgICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAocmVkKTogZXhwaXJlZFJlZnJlc2hUb2tlbkVycm9yXG4gICAgICAgIGVuZFxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChyZWQpOiBjYXVnaHQgYnkgZ2xvYmFsIGhhbmRsZXJcbiAgICAgICAgTm90ZSBvdmVyIGNsaWVudCAocmVkKTogSlMgc3RhdGU6IHtpc0xvZ2dlZEluOiBmYWxzZX1cbiAgICBlbmRcbiAgICBOb3RlIG92ZXIgY2xpZW50IChyZWQpOiByZWRpcmVjdCB0byBsb2dpbiBwYWdlXG4iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgTm90ZSBvdmVyIGNsaWVudCAocmVkKTogSlMgc3RhdGU6IHtpc0xvZ2dlZEluOiB0cnVlfVxuICAgIE5vdGUgb3ZlciBjbGllbnQgKHJlZCk6IGNvb2tpZSBzdGF0ZToge2F1dGhUb2tlbjogZmFsc2UsIHJlZnJlc2hUb2tlbjogZmFsc2V9XG5cbiAgICBwYXIgcHJpdmF0ZSByZXF1ZXN0XG4gICAgICAgIGNsaWVudCAocmVkKSAtPj4gc2VydmVyOiBnZXRTb21ldGhpbmdQcml2YXRlKG5vIGF1dGhUb2tlbkhlYWRlciwgLi4uYXJncylcbiAgICAgICAgTm90ZSBvdmVyIHNlcnZlcjogdmFsaWRhdGVBdXRoVG9rZW4oKVxuICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAocmVkKTogZXhwaXJlZEF1dGhUb2tlbkVycm9yXG4gICAgZW5kXG4gICAgXG4gICAgcGFyIHRyeSByZWZyZXNoXG4gICAgICAgIE5vdGUgb3ZlciBjbGllbnQgKHJlZCk6IGNhdWdodCBieSBnbG9iYWwgaGFuZGxlclxuICAgICAgICBwYXIgdG9rZW4gcmVmcmVzaCByZXF1ZXN0XG4gICAgICAgICAgICBjbGllbnQgKHJlZCkgLT4-IHNlcnZlcjogcmVmcmVzaChubyByZWZyZXNoVG9rZW5IZWFkZXIpXG4gICAgICAgICAgICBOb3RlIG92ZXIgc2VydmVyOiB2YWxpZGF0ZVJlZnJlc2hUb2tlbigpXG4gICAgICAgICAgICBzZXJ2ZXIgLT4-IGNsaWVudCAocmVkKTogZXhwaXJlZFJlZnJlc2hUb2tlbkVycm9yXG4gICAgICAgIGVuZFxuICAgICAgICBOb3RlIG92ZXIgY2xpZW50IChyZWQpOiBjYXVnaHQgYnkgZ2xvYmFsIGhhbmRsZXJcbiAgICAgICAgTm90ZSBvdmVyIGNsaWVudCAocmVkKTogSlMgc3RhdGU6IHtpc0xvZ2dlZEluOiBmYWxzZX1cbiAgICBlbmRcbiAgICBOb3RlIG92ZXIgY2xpZW50IChyZWQpOiByZWRpcmVjdCB0byBsb2dpbiBwYWdlXG4iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)
